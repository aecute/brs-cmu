{% extends "base.html" %}
{% block title %}Reservation | {{ block.super }} {% endblock %}

<style>
  {% block style %}
  body
  {
      background: url(http://www.listofdownload.com/wp-content/uploads/2013/11/Londonstreet-Double-decker-bus-TiltShift-Wallpaper-1920x1200.jpg) no-repeat center center fixed; 
      -webkit-background-size: cover;
      -moz-background-size: cover;
      -o-background-size: cover;
      background-size: cover;
  }

  {% endblock %}
</style>

{% block content %}

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Bus Reservation system</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/">Bus Schedule</a></li>
            <li  class="active"><a href="#">Reservation</a></li>
            <li><a href="/drivers">Drivers Status</a></li>
          </ul>

          <ul class="nav navbar-nav navbar-right">

            {% if user.is_authenticated %}
            <li><a href="#">Welcome, {{ user.username }}</a></li>
            {% endif %}

            <li><a href='{% url "logout" %}'>Logout</a></li>
          </ul>

        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">

    <br><br><br>

      <div class="panel panel-default">
        <div class="panel-heading">Search</div>
        <div class="panel-body">

        <div class="row">

          <div class="col-sm-6 col-sm-offset-3 ">
            <form class="form-inline" role="form" method="post">{% csrf_token %}

              <div class="form-group">
                <label for="origin">Origin: </label>
                <select class="form-control" name="origin">
                  {% if bus_schedules_error == 0 %}
                    <option>-------</option>
                  {% else %}
                  <option>Select an Origin</option>

                    {% for bus_schedule in bus_schedules %}
                        <option>{{ bus_schedule.id }}</option>
                    {% endfor %}

                  {% endif %}
                </select>
              </div>

              <div class="form-group">
                <label for="destination">Destination: </label>
                <select class="form-control" name="destination">
                  {% if bus_schedules_error == 0 %}
                    <option>-------</option>
                  {% else %}
                  <option>Select a Destination</option>

                    {% for bus_schedule in bus_schedules %}
                        <option>{{ bus_schedule.destination }}</option>
                    {% endfor %}

                  {% endif %}
                </select>
              </div>

              <button type="submit" class="btn btn-default">Search</button>

            </form>

          </div>

        </div>

          

        </div>
      </div>

      <div class="panel panel-primary">
        <div class="panel-heading">Result</div>
        <div class="panel-body">

          {% if error == 0 %}

            <div class="alert alert-danger">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
              <strong>Fail!</strong> Please enter search first or Not Found.
            </div>

          {% else %}
            <div class="table-responsive"> 
              <table  class="table table-hover">
                <tr>
                  <th>Number</th>
                  <th>Company Name</th>
                  <th>Bus ID</th>
                  <th>Origin</th>
                  <th>Destination</th>
                  <th>Platform</th>
                  <th>Date</th>
                  <th>Price</th>
                  <th>Status</th>
                  <th>Tickets</th>
                </tr>

                {% for result in results %}

                <tr>
                  <td> {{ result.id }} </td>
                  <td> {{ result.company_name }} </td>
                  <td> {{ result.bus_id }} </td>
                  <td> {{ result.origin }} </td>
                  <td> {{ result.destination }} </td>
                  <td> {{ result.platform }} </td>
                  <td> {{ result.date }} </td>
                  <td> {{ result.price }} </td>

                  {% for b in bus %}

                    {% if b.bus_id|stringformat:"s" == result.bus_id|stringformat:"s" %}
    
                      {% if b.reserve_seat == b.seats %}
                        <td class="text-danger"> Full </td>
                        <td class="text-danger"><button type="button" class="btn btn-warning disabled">BUY</button></td>
                      {% else %}
                        <td class="text-success"> Available </td>
                        <td class="text-danger">
                        <a href="/ticket/{{ result.id }}" class="btn btn-warning" role="button">BUY</a></td>
                      {% endif %}

                    {% endif %}

                  {% endfor %}

                </tr>

                {% endfor %}
              </table>
            </div>

        {% endif %}
          
        </div>
      </div>

    </div> 

{% endblock %}


<!--   company_name = models.ForeignKey(Bus_company, default=1)
  bus_id = models.ForeignKey(Bus, default=1)
  origin = models.CharField(max_length=40)
  destination = models.CharField(max_length=40)
  platform = models.CharField(max_length=40)
  date = models.DateTimeField()
  price = models.IntegerField()

 -->

